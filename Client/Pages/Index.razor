@page "/"
@inject HttpClient Http


<PageTitle>Index</PageTitle>

<h3>Search YouTube Videos</h3>

<!-- Search input and button -->
<div>
    <input type="text" @bind="searchTerm" placeholder="Enter search term..." />
    <button @onclick="SearchVideos">Search</button>
</div>

<RadzenButton Text="Reset" Click="@Reset" Style="margin-top: 20px; margin-bottom: 5px;" />
<!-- Radzen Data Grid and its Title -->
<RadzenDataGrid Style="width: 1200px; height: 700px;"
                Data="@videos" TItem="Videos" Count="@videos.Count" PageSize="10"
                AllowPaging="true" AllowSorting="true" AllowColumnResize="true" 
                AllowColumnPicking="true" ShowPagingSummary="true" AllowFiltering="true" 
                IsLoading=@isLoading @ref="grid" RowSelect="OnRowSelect">
    <Columns>
        <RadzenDataGridColumn TItem="Videos" Property="Title" Title="Title" Width="300px" />
        <RadzenDataGridColumn TItem="Videos" Property="Channel" Title="Channel" Width="100px" />
        <RadzenDataGridColumn TItem="Videos" Property="Published" Title="Published" Width="100px" />
        <RadzenDataGridColumn TItem="Videos" Property="Duration" Title="Duration" Width="100px" />
        <RadzenDataGridColumn TItem="Videos" Property="Url" Title="URL" Width="224px">
            <Template Context="video">
                <a href="@video.Url" target="_blank">@video.Url</a>
            </Template>
        </RadzenDataGridColumn>
    </Columns>
</RadzenDataGrid>

<!-- Button to display the selected video details -->
<button @onclick="ShowSelectedVideoDetails">Show Details</button>

<!-- This section will display the details of the selected video -->
@if (selectedVideo != null)
{
    <div>
        <h3>Selected Video Details</h3>
        <p>Title: @selectedVideo.Title</p>
        <p>Channel: @selectedVideo.Channel</p>
        <p>Channel: @selectedVideo.Published</p>
        <p>Channel: @selectedVideo.Duration</p>
        <p>Channel: @selectedVideo.Url</p>
    </div>
}

<!-- Radzen Button to fill the Data Grid code -->
@code {
    private RadzenDataGrid<Videos>? grid;
    private string? searchTerm;
    private List<Videos> videos = new List<Videos>();
    private bool isLoading = false;
    private async Task SearchVideos()
    {
        isLoading = true;
        var response = await Http.GetAsync($"https://func-app-powershell001.azurewebsites.net/api/HttpTrigger3?searchterm={searchTerm}");
        if (response.IsSuccessStatusCode)
        {
            var jsonString = await response.Content.ReadAsStringAsync();
            var result = System.Text.Json.JsonSerializer.Deserialize<List<Videos>>(jsonString);
            videos = result ?? new List<Videos>(); // In case result is null, assign an empty list
        }
        else
        {
            videos = new List<Videos>(); // Clear the list or handle the error as needed
        }
        isLoading = false;
    }

    private async Task Reset()
    {
        isLoading = true;
        grid.Reset(true); 
        await grid.FirstPage(true);
        isLoading = false;
    }

    void OnRowSelect(Videos video)
    {
        selectedVideo = video;
    }

    // This method is triggered when the "Show Details" button is clicked.
    void ShowSelectedVideoDetails()
    {
        // You can add code here if you want to do something when the button is clicked,
        // but simply assigning the selected video to 'selectedVideo' is enough to display its details.
        // The UI will update automatically because of Blazor's reactive nature.
    }


}